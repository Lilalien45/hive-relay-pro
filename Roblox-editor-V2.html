<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">

<title>Roblox Web Master Studio Viewer</title>

<script src="https://cdn.jsdelivr.net/npm/three@0.160/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/eruda"></script>
<script>eruda.init();</script>

<style>

body{
margin:0;
overflow:hidden;
background:#0f1117;
color:white;
font-family:Arial;
}

#ui{
position:absolute;
width:100%;
height:100%;
pointer-events:none;
}

.panel{
background:#000a;
padding:10px;
border-radius:8px;
pointer-events:auto;
max-width:90vw;
max-height:80vh;
overflow:auto;
}

#menu{
position:absolute;
top:10px;
left:50%;
transform:translateX(-50%);
}

#explorer{
position:absolute;
left:10px;
top:70px;
width:220px;
height:420px;
overflow:auto;
}

#properties{
position:absolute;
right:10px;
top:70px;
width:260px;
max-height:320px;
overflow:auto;
}

#timeline{
position:absolute;
bottom:10px;
left:50%;
transform:translateX(-50%);
width:min(420px,90vw);
}

#controls{
position:absolute;
bottom:10px;
left:10px;
width:200px;
}

#controls button{
padding:12px 16px;
font-size:18px;
}

button{
background:#222;
color:white;
border:none;
padding:6px 12px;
margin:4px;
border-radius:6px;
cursor:pointer;
}

@media(max-width:600px){

#explorer{
width:45vw;
height:50vh;
}

#properties{
width:45vw;
height:40vh;
}

}

</style>

</head>

<body>

<div id="ui">

<div id="menu" class="panel">
<button onclick="setMode('host')">Host</button>
<button onclick="setMode('private')">Private</button>
<button onclick="setMode('join')">Join</button>
<button onclick="setMode('invite')">Invite Only</button>
<input type="file" id="placeLoader">
</div>

<div id="explorer" class="panel">
<h3>Explorer</h3>
<div id="explorerTree"></div>
</div>

<div id="properties" class="panel">
<h3>Properties</h3>
<div id="propertiesData"></div>
</div>

<div id="timeline" class="panel">
<input type="range" id="timelineSlider" min="0" max="100" value="0">
</div>

<!-- CAMERA CONTROLS -->

<div id="controls" class="panel">

<div style="display:grid;grid-template-columns:repeat(3,1fr);gap:6px;max-width:160px;">

<button style="grid-column:2" onclick="moveCam('up')">⬆</button>

<button onclick="moveCam('left')">⬅</button>
<button style="visibility:hidden"></button>
<button onclick="moveCam('right')">➡</button>

<button style="grid-column:2" onclick="moveCam('down')">⬇</button>

</div>

<br>

<div style="display:flex;flex-direction:column;gap:8px;">
<button onclick="zoomCam('in')">Zoom In +</button>
<button onclick="zoomCam('out')">Zoom Out −</button>
</div>

</div>

</div>

<script>

/* ENGINE STATE */

let scene,camera,renderer,xmlDoc=null;
let camTarget=new THREE.Vector3();
let instanceMap=new Map();
let networkMode="private";
let animationTime=0;

/* INIT ENGINE */

function initEngine(){

scene=new THREE.Scene();

let w=window.innerWidth;
let h=window.innerHeight;

camera=new THREE.PerspectiveCamera(
75,w/h,0.1,50000
);

renderer=new THREE.WebGLRenderer({antialias:true});
renderer.setSize(w,h);

document.body.appendChild(renderer.domElement);

scene.add(new THREE.HemisphereLight(0xffffff,0x444444,1));
scene.add(new THREE.GridHelper(2000,200));

initControls();
animate();

}

/* CAMERA CONTROLS (MOUSE ONLY) */

function initControls(){

let rot=false,lx=0,ly=0;

window.addEventListener("pointerdown",e=>{
rot=true;
lx=e.clientX;
ly=e.clientY;
});

window.addEventListener("pointerup",()=>rot=false);

window.addEventListener("pointermove",e=>{
if(!rot)return;

camera.position.x+=(e.clientX-lx)*0.05;
camera.position.y-=(e.clientY-ly)*0.05;

lx=e.clientX;
ly=e.clientY;
});

window.addEventListener("wheel",e=>{
camera.position.z+=e.deltaY*0.5;
});

}

/* CAMERA MOVE BUTTONS */

function moveCam(dir){

let speed=40;

if(dir==="up") camera.position.y+=speed;
if(dir==="down") camera.position.y-=speed;
if(dir==="left") camera.position.x-=speed;
if(dir==="right") camera.position.x+=speed;

}

/* ZOOM BUTTONS */

function zoomCam(type){

let speed=150;

if(type==="in") camera.position.z-=speed;
if(type==="out") camera.position.z+=speed;

}

/* LOOP */

function animate(){

requestAnimationFrame(animate);

animationTime+=0.01;
updateAnimations();

camera.lookAt(camTarget);
renderer.render(scene,camera);

}

/* SESSION MODE */

function setMode(mode){
networkMode=mode;
alert("Session Mode: "+mode);
}

/* FILE LOAD */

placeLoader.addEventListener("change",e=>{
let f=e.target.files[0];
if(!f)return;

let r=new FileReader();
r.onload=()=>{
parseRobloxXML(r.result);
};
r.readAsText(f);

});

/* PARSER */

function parseRobloxXML(text){

xmlDoc=new DOMParser().parseFromString(text,"text/xml");

buildExplorer();
buildScene();

}

/* EXPLORER */

function buildExplorer(){

let tree=document.getElementById("explorerTree");
tree.innerHTML="";

xmlDoc.documentElement.childNodes.forEach(n=>{
if(n.nodeName==="Item"){
tree.appendChild(buildExplorerNode(n));
}
});

}

function buildExplorerNode(node){

let div=document.createElement("div");
div.style.marginLeft="12px";

let name=node.querySelector("Properties > string[name='Name']");
let label=name?name.textContent:node.getAttribute("class");

let btn=document.createElement("button");
btn.style.width="100%";
btn.textContent=label;
btn.onclick=()=>showProperties(node);

div.appendChild(btn);

node.childNodes.forEach(c=>{
if(c.nodeName==="Item"){
div.appendChild(buildExplorerNode(c));
}
});

return div;

}

/* PROPERTY VIEW */

function showProperties(node){

let panel=document.getElementById("propertiesData");

let html="<b>"+(
node.querySelector("Properties > string[name='Name']")?.textContent
||node.getAttribute("class")
)+"</b><br>";

node.querySelectorAll("Properties > *").forEach(p=>{
html+=p.getAttribute("name")+": "+p.textContent+"<br>";
});

panel.innerHTML=html;

}

/* UTIL */

function parseVector3(s){
let a=s.split(",");
return{
x:parseFloat(a[0])||1,
y:parseFloat(a[1])||1,
z:parseFloat(a[2])||1
};
}

/* RENDER INSTANCES */

function renderInstance(node,parent){

let cls=node.getAttribute("class");
let obj=null;

if(cls && cls.includes("Part")){

let size=node.querySelector("Properties > Vector3[name='Size']");
let s=size?parseVector3(size.textContent):{x:1,y:1,z:1};

let mat=new THREE.MeshStandardMaterial({
color:Math.random()*0xffffff
});

obj=new THREE.Mesh(
new THREE.BoxGeometry(s.x,s.y,s.z),
mat
);

}

else if(cls && cls.includes("Gui")){

obj=new THREE.Group();

let plane=new THREE.Mesh(
new THREE.PlaneGeometry(5,3),
new THREE.MeshBasicMaterial({
color:0xffffff,
side:THREE.DoubleSide
})
);

obj.add(plane);

}

else if(cls==="Model"||cls==="Folder"){
obj=new THREE.Group();
}

if(obj){

instanceMap.set(node,obj);

(parent?parent:scene).add(obj);

node.childNodes.forEach(c=>{
if(c.nodeName==="Item"){
renderInstance(c,obj);
}
});

}

}

/* BUILD SCENE */

function buildScene(){

scene.clear();

scene.add(new THREE.HemisphereLight(0xffffff,0x444444,1));
scene.add(new THREE.GridHelper(2000,200));

xmlDoc.documentElement.childNodes.forEach(n=>{
if(n.nodeName==="Item"){
renderInstance(n,null);
}
});

autoFrameCamera();

}

/* CAMERA FRAME */

function autoFrameCamera(){

let box=new THREE.Box3().setFromObject(scene);
let center=box.getCenter(new THREE.Vector3());
let size=box.getSize(new THREE.Vector3());

let dist=Math.max(size.x,size.y,size.z)*3+300;

camTarget.copy(center);

camera.position.set(
center.x+dist,
center.y+dist,
center.z+dist
);

}

/* ANIMATIONS */

function updateAnimations(){

instanceMap.forEach((obj,node)=>{

let anim=node.querySelector("Properties > string[name='AnimationId']");

if(anim){
obj.rotation.y=Math.sin(animationTime)*1.5;
}

});

}

/* RESIZE */

window.addEventListener("resize",()=>{
camera.aspect=window.innerWidth/window.innerHeight;
camera.updateProjectionMatrix();
renderer.setSize(window.innerWidth,window.innerHeight);
});

/* START */

initEngine();

</script>

</body>
</html>
